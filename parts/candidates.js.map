{"version":3,"sources":["candidates.es"],"names":["i18n","window","__","bind","sortable","getSortValue","sortIndex","ship","direction","parseInt","api_nowhp","api_maxhp","akashi","perHP","api_id","allFleetShipIdSelector","Array","keys","map","fleetId","id1","id2","id3","id4","shipFleetIdMapSelector","state","info","ships","fleetIds","repairIdSelector","repair","dock","api_ship_id","candidateShipsSelector","const","$ships","shipFleetIdMap","repairIds","flow","filter","sortBy","getHPBackgroundColor","nowhp","maxhp","percentage","mix","alpha","css","Candidates","rowRenderer","key","index","style","props","color","Math","round","background","api_lv","resources","api_name","marginLeft","render","marginBottom","handleSort","height","width","length"],"mappings":"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","file":"candidates.es","sourcesContent":["import React, { Component } from 'react'\nimport { createSelector } from 'reselect'\nimport { connect } from 'react-redux'\nimport fp from 'lodash/fp'\nimport { mapValues, findIndex, includes, map } from 'lodash'\nimport { AutoSizer, List } from 'react-virtualized'\nimport { ButtonGroup, Button } from 'react-bootstrap'\nimport FA from 'react-fontawesome'\nimport chroma from 'chroma-js'\n\nimport { repairsSelector, fleetShipsIdSelectorFactory } from 'views/utils/selectors'\nimport { resolveTime } from 'views/utils/tools'\n\nimport { akashiEstimate, timePerHPCalc } from './functions'\n\nconst { i18n } = window\nconst __ = i18n['poi-plugin-anchorage-repair'].__.bind(i18n['poi-plugin-anchorage-repair'])\n\nconst sortable = [\n  'HP',\n  'Akashi Time',\n  'Per HP',\n]\n\nconst getSortValue = sortIndex => (ship) => {\n  const direction = sortIndex % 2 ? -1 : 1\n\n  switch (parseInt(sortIndex / 2, 10)) {\n    case 0:\n      return (ship.api_nowhp / ship.api_maxhp) * direction\n    case 1:\n      return ship.akashi * direction\n    case 2:\n      return ship.perHP * direction\n    default:\n      return ship.api_id\n  }\n}\n\nconst allFleetShipIdSelector = createSelector(\n  [\n    ...[...new Array(4).keys()].map(fleetId => fleetShipsIdSelectorFactory(fleetId)),\n  ],\n  (id1, id2, id3, id4) => [id1, id2, id3, id4]\n)\n\nconst shipFleetIdMapSelector = createSelector(\n  [\n    state => state.info.ships,\n    allFleetShipIdSelector,\n  ], (ships, fleetIds) =>\n    mapValues(ships, ship => findIndex(fleetIds, fleetId => includes(fleetId, ship.api_id)))\n)\n\nconst repairIdSelector = createSelector(\n  [repairsSelector],\n  repair => map(repair, dock => dock.api_ship_id)\n)\n\nconst candidateShipsSelector = sortIndex => createSelector(\n  [\n    state => state.info.ships,\n    state => state.const.$ships,\n    shipFleetIdMapSelector,\n    repairIdSelector,\n  ], (ships, $ships, shipFleetIdMap, repairIds) =>\n      fp.flow(\n        fp.filter(ship => akashiEstimate(ship) > 0 && !includes(repairIds, ship.api_id)),\n        fp.map(ship => ({\n          ...$ships[ship.api_ship_id],\n          ...ship,\n          akashi: akashiEstimate(ship),\n          perHP: timePerHPCalc(ship),\n          fleetId: shipFleetIdMap[ship.api_id],\n        })),\n        fp.sortBy(ship => getSortValue(sortIndex)(ship))\n      )(ships)\n)\n\nconst getHPBackgroundColor = (nowhp, maxhp) => {\n  const percentage = nowhp / maxhp\n  return percentage > 0.75\n    ? chroma.mix('rgb(253, 216, 53)', 'rgb(67, 160, 71)', (percentage - 0.75) / 0.25, 'lab').alpha(0.6).css()\n    : chroma.mix('rgb(245, 124, 0)', 'rgb(253, 216, 53)', (percentage - 0.5) / 0.25, 'lab').alpha(0.6).css()\n}\n\n// console.log(\n//   chroma.mix('rgb(253, 216, 53)', 'rgb(67, 160, 71)', 0.5, 'lch').alpha(0.6).css(),\n//   chroma.mix('rgb(253, 216, 53)', 'rgb(67, 160, 71)', 0.5, 'rgb').alpha(0.6).css(),\n//   chroma.mix('rgb(253, 216, 53)', 'rgb(67, 160, 71)', 0.5, 'hsl').alpha(0.6).css(),\n//   chroma.mix('rgb(253, 216, 53)', 'rgb(67, 160, 71)', 0.5, 'lab').alpha(0.6).css(),\n// )\n  // (nowhp / maxhp) > 0.75 ? 'rgba(67, 160, 71, 0.6)' : 'rgba(253, 216, 53, 0.6)'\n\nconst Candidates = connect(\n  (state, { sortIndex = 0 }) => ({\n    ships: candidateShipsSelector(sortIndex)(state),\n  })\n)(class Candidates extends Component {\n\n  rowRenderer = ({ key, index, style }) => {\n    const { ships } = this.props\n    const ship = ships[index]\n    const color = getHPBackgroundColor(ship.api_nowhp, ship.api_maxhp)\n    const percentage = Math.round((100 * ship.api_nowhp) / ship.api_maxhp)\n    return (\n      <div\n        className=\"candidate-ship-item\"\n        style={{\n          ...style,\n          background: `linear-gradient(90deg, ${color} ${percentage}%, rgba(0, 0, 0, 0) 50%)`,\n        }}\n        key={key}\n      >\n        <span className=\"ship-name\">\n          { `Lv.${ship.api_lv} ${window.i18n.resources.__(ship.api_name)}${ship.fleetId < 0 ? '' : `/${ship.fleetId + 1}`}` }\n        </span>\n        <span style={{ marginLeft: '1em' }}>{`(${ship.api_nowhp} / ${ship.api_maxhp})`}</span>\n        <span style={{ marginLeft: '2em' }}>{ `${resolveTime(ship.akashi / 1000)} / ${resolveTime(ship.perHP / 1000)}` }</span>\n      </div>\n    )\n  }\n\n  render() {\n    const { ships, sortIndex } = this.props\n    return (\n      <div\n        id=\"candidate-list\"\n      >\n        <div style={{ marginBottom: '1ex' }}>\n          <ButtonGroup bsSize=\"small\">\n            {\n              [...new Array(6).keys()].map(index => (\n                <Button\n                  key={index}\n                  onClick={this.props.handleSort(index)}\n                  bsStyle={index === sortIndex ? 'success' : 'default'}\n                >\n                  {__(sortable[parseInt(index / 2, 10)])}<FA name={index % 2 === 0 ? 'arrow-up' : 'arrow-down'} />\n                </Button>\n              ))\n            }\n          </ButtonGroup>\n        </div>\n        <AutoSizer>\n          {\n            ({ height, width }) => (\n              <List\n                sortIndex={sortIndex}\n                height={height}\n                width={width}\n                rowHeight={40}\n                rowCount={ships.length}\n                rowRenderer={this.rowRenderer}\n              />\n            )\n          }\n        </AutoSizer>\n      </div>\n    )\n  }\n})\n\nexport default Candidates\n"]}
